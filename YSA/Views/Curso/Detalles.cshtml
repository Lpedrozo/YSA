@model YSA.Web.Models.ViewModels.CursoCompletoViewModel
@{
    ViewData["Title"] = Model.Titulo;
}

<style>
    /* ------------------------------------- */
    /* 1. Paleta Monocromática (B/W)         */
    /* ------------------------------------- */
    :root {
        --color-primary: #000000; /* Negro para acentos y CTA */
        --color-secondary: #343a40; /* Gris oscuro para títulos */
        --color-background: #ffffff; /* Fondo blanco */
        --color-card-bg: #f8f8f8; /* Gris muy claro para tarjetas */
        --color-text-dark: #212529; /* Texto principal (negro) */
        --color-border: #dee2e6; /* Gris claro para bordes */
    }

    /* Estilos generales */
    body {
        background-color: var(--color-background);
        color: var(--color-text-dark);
    }

    /* Contenedor principal para centrar el contenido */
    .course-details-container {
        max-width: 1200px; /* Hacemos el contenedor un poco más ancho */
        padding-top: 40px;
    }

    /* ------------------------------------- */
    /* 2. Sección Principal (Imagen y Título)*/
    /* ------------------------------------- */
    .course-hero {
        position: relative;
        width: 100%;
        /* Ajuste: Usaremos un padding vertical más sutil para que no sea tan grande en móviles */
        padding-top: 56.25%; /* Ratio 16:9 */
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    @@media (max-width: 991.98px) {
        /* En dispositivos pequeños, hacemos la imagen más compacta para que el contenido sea visible antes */
        .course-hero

    {
        padding-top: 75%; /* Ratio 4:3 en móviles, o simplemente un valor fijo si se prefiere */
        margin-bottom: 20px !important;
    }

    }

    .course-hero img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .hero-title-block {
        padding: 20px 0;
        border-bottom: 2px solid var(--color-primary);
        margin-bottom: 20px;
    }

        .hero-title-block h1 {
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 0.5rem;
        }

    /* ------------------------------------- */
    /* 3. Tarjeta de Precio (Compra)         */
    /* ------------------------------------- */
    .price-card {
        border-radius: 8px;
        border: 1px solid var(--color-border);
        background-color: var(--color-card-bg); /* Fondo gris claro */
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        color: var(--color-text-dark);
    }

    /* Nuevo: Estilo Flotante para Móviles */
    @@media (max-width: 991.98px) {
        .mobile-buy-bar

    {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        z-index: 1030; /* Alto para estar sobre casi todo */
        padding: 10px;
        background-color: var(--color-card-bg);
        border-top: 1px solid var(--color-border);
        box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    /* Oculta la tarjeta completa en la columna lateral en móviles, ya que usaremos el flotante */
    .price-card-lg {
        display: none !important;
    }

    }

    /* Muestra la tarjeta completa en el layout de columna grande */
    @@media (min-width: 992px) {
        .price-card-lg

    {
        display: block !important;
    }

    .mobile-buy-bar {
        display: none !important;
    }

    }


    .btn-action {
        background-color: var(--color-primary) !important;
        border-color: var(--color-primary) !important;
        color: #ffffff !important;
        padding: 10px 20px;
        font-size: 1.1em;
        font-weight: 600;
        border-radius: 6px;
        transition: background-color 0.3s, transform 0.2s;
    }

        .btn-action:hover {
            background-color: var(--color-secondary) !important;
            border-color: var(--color-secondary) !important;
            transform: translateY(-1px);
        }

    /* ------------------------------------- */
    /* 4. Acordeón (Índice - Solo Títulos)   */
    /* ------------------------------------- */
    .accordion-item {
        border: 1px solid var(--color-border);
        margin-bottom: 8px;
        border-radius: 6px;
        overflow: hidden;
    }

    .accordion-button {
        background-color: var(--color-card-bg);
        color: var(--color-text-dark);
        font-weight: 600;
    }

        .accordion-button:not(.collapsed) {
            background-color: var(--color-primary);
            color: #ffffff;
            box-shadow: none;
        }

    .list-group-item {
        background-color: var(--color-background);
        border-bottom: 1px dotted var(--color-border);
        color: var(--color-secondary);
    }

        /* Ocultamos el ícono de video, solo mostramos el texto */
        .list-group-item i.fa-play-circle {
            display: none;
        }
</style>

<div class="container course-details-container pb-5 mb-5">

    <div class="hero-title-block">
        <h1 class="">@Model.Titulo</h1>
        <p class="lead text-secondary">@Html.Raw(Model.DescripcionCorta)</p>
    </div>

    <div class="row g-5 pb-5 mb-5">

        <div class="col-lg-8">
            <div class="course-hero mb-4">
                <img src="@Model.UrlImagen" alt="Imagen del curso: @Model.Titulo" />
            </div>

            <h2 class="mb-3 text-secondary">Acerca de este curso</h2>
            <div class="mb-5 text-dark">
                @Html.Raw(Model.DescripcionLarga)
            </div>

            <h2 class="mb-3 text-secondary">Contenido del Curso</h2>
            <div class="accordion" id="acordeonModulos">
                @if (Model.Modulos != null && Model.Modulos.Any())
                {
                    @foreach (var modulo in Model.Modulos)
                    {
                        <div class="accordion-item shadow-sm">
                            <h2 class="accordion-header" id="heading_@modulo.Id">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse_@modulo.Id" aria-expanded="false" aria-controls="collapse_@modulo.Id">
                                    @modulo.Titulo
                                </button>
                            </h2>
                            <div id="collapse_@modulo.Id" class="accordion-collapse collapse" aria-labelledby="heading_@modulo.Id" data-bs-parent="#acordeonModulos">
                                <div class="accordion-body p-0">
                                    <ul class="list-group list-group-flush">
                                        @if (modulo.Lecciones != null && modulo.Lecciones.Any())
                                        {
                                            @foreach (var leccion in modulo.Lecciones)
                                            {
                                                <li class="list-group-item">
                                                    <div class="d-flex align-items-center">
                                                        <i class="fas @(Model.TieneAcceso ? "fa-check-circle text-success" : "fa-lock text-secondary") me-2"></i>
                                                        <span class="fw-normal flex-grow-1">@leccion.Titulo</span>
                                                    </div>
                                                </li>
                                            }
                                        }
                                        else
                                        {
                                            <li class="list-group-item text-muted">No hay lecciones en este módulo.</li>
                                        }
                                    </ul>
                                </div>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="alert alert-warning text-center">
                        <i class="fas fa-exclamation-triangle me-2"></i>Este curso no contiene módulos ni lecciones.
                    </div>
                }
            </div>
        </div>

        <div class="col-lg-4 d-none d-lg-block">
            <div class="sticky-top" style="top: 20px;">
                <div class="card price-card price-card-lg text-center p-4">
                    <h5 class="fw-bold text-secondary">Precio del Curso:</h5>
                    <h2 class="display-6 fw-bold mb-3" style="color: var(--color-primary);">@Model.Precio.ToString("C", System.Globalization.CultureInfo.CreateSpecificCulture("es-VE"))</h2>
                    <p class="text-secondary mb-4"><i class="fas fa-check-circle text-success me-2"></i>Acceso de por vida</p>

                    @if (Model.TieneAcceso)
                    {
                        <a asp-action="VerCurso" asp-controller="Curso" asp-route-id="@Model.Id" class="btn btn-action w-100">Ver Contenido</a>

                        <div class="alert alert-success d-flex align-items-center justify-content-center mt-3" role="alert">
                            <i class="fas fa-check-circle me-2"></i>Ya tienes acceso a este curso.
                        </div>
                    }
                    else if (Model.EstaEnValidacion)
                    {
                        <div class="alert alert-info d-flex align-items-center justify-content-center" role="alert">
                            <i class="fas fa-hourglass-half me-2"></i>Su pago está en proceso de validación.
                        </div>
                    }
                    else
                    {
                        <form asp-controller="Pedido" asp-action="IniciarCompra" method="post">
                            <input type="hidden" name="cursoId" value="@Model.Id" />
                            <button type="submit" class="btn btn-action w-100">Inscribirse ahora</button>
                        </form>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<div class="mobile-buy-bar d-lg-none">
    <div class="d-flex align-items-center">
        <h5 class="fw-bold mb-0 me-3">Precio:</h5>
        <h4 class="fw-bold mb-0" style="color: var(--color-primary);">@Model.Precio.ToString("C", System.Globalization.CultureInfo.CreateSpecificCulture("es-VE"))</h4>
    </div>
    <div class="flex-grow-1 ms-3 text-end">
        @if (Model.TieneAcceso)
        {
            <a asp-action="VerCurso" asp-controller="Curso" asp-route-id="@Model.Id" class="btn btn-action btn-sm">Ver Contenido</a>
        }
        else if (Model.EstaEnValidacion)
        {
            <span class="text-info fw-semibold"><i class="fas fa-hourglass-half me-1"></i>En Validación</span>
        }
        else
        {
            <form asp-controller="Pedido" asp-action="IniciarCompra" method="post" class="d-inline">
                <input type="hidden" name="cursoId" value="@Model.Id" />
                <button type="submit" class="btn btn-action btn-sm">Comprar Ahora</button>
            </form>
        }
    </div>
</div>