@model YSA.Web.Models.ViewModels.CursosIndexViewModel

<div class="container mt-4 mb-5">
    <h2 class="text-center mt-5 mb-4 text-black">Explora todos los cursos</h2>
    <hr style="color:#000;" />

    <div class="row justify-content-center mb-4">
        <div class="col-md-6">
            <div class="input-group">
                <input type="text" class="form-control" id="searchStringInput" placeholder="Buscar por título o descripción..." value="@ViewData["searchString"]" />
                <button class="btn btn-primary" type="button" id="searchButton">Buscar</button>
            </div>
        </div>
    </div>

    <div class="filtro-menu">
        <div class="filtro-item">
            <a href="#" class="filtro-btn @(string.IsNullOrEmpty(Model.CategoriaActual) ? "active" : "")" data-filtro-categoria="">Todas</a>
        </div>
        @foreach (var categoria in Model.CategoriasDisponibles)
        {
            <div class="filtro-item">
                <a href="#" class="filtro-btn @(Model.CategoriaActual == categoria ? "active" : "")" data-filtro-categoria="@categoria">@categoria</a>
            </div>
        }

        <div class="filtro-item">
            <a href="#" class="filtro-btn @(!ViewBag.NivelActual.HasValue ? "active" : "")" data-filtro-nivel="">Todos los Niveles</a>
        </div>
        @foreach (var nivel in (IEnumerable<YSA.Core.Enums.NivelDificultad>)Enum.GetValues(typeof(YSA.Core.Enums.NivelDificultad)))
        {
            <div class="filtro-item">
                <a href="#" class="filtro-btn @(ViewBag.NivelActual == (int)nivel ? "active" : "")" data-filtro-nivel="@((int)nivel)">@nivel.ToString()</a>
            </div>
        }
    </div>

    <div id="cursos-list-container">
        @if (!Model.Cursos.Any())
        {
            <div class="alert alert-warning text-center" role="alert">
                No se encontraron cursos con los filtros aplicados.
            </div>
        }
        else
        {
            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4">
                @foreach (var curso in Model.Cursos)
                {
                    <div class="col">
                        <div class="card h-100 shadow-sm" data-bs-toggle="popover" data-bs-trigger="hover focus" data-bs-placement="right" data-bs-html="true">
                            <div style="display: none;" class="popover-course-data">
                                <span data-course-id="@curso.Id"></span>
                                <span data-course-title="@curso.Titulo"></span>
                                <span data-course-description="@curso.DescripcionCorta"></span>
                                <span data-course-image="@curso.UrlImagen"></span>
                                <span data-course-price="@curso.Precio.ToString("C", System.Globalization.CultureInfo.CreateSpecificCulture("es-VE"))"></span>
                            </div>
                            @if (!string.IsNullOrEmpty(curso.UrlImagen))
                            {
                                <img src="@curso.UrlImagen" class="card-img-top" alt="Imagen del curso: @curso.Titulo" style="height: 200px; object-fit: cover;">
                            }
                            else
                            {
                                <img src="https://via.placeholder.com/400x200.png?text=Sin+Imagen" class="card-img-top" alt="Imagen de marcador de posición" style="height: 200px; object-fit: cover;">
                            }
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">@curso.Titulo</h5>
                                <p class="card-text text-muted flex-grow-1">@curso.DescripcionCorta</p>
                                @if (curso.ListaCategorias != null && curso.ListaCategorias.Any())
                                {
                                    <div class="card-categories">
                                        @foreach (var categoria in curso.ListaCategorias)
                                        {
                                            <span class="badge bg-secondary">@categoria</span>
                                        }
                                    </div>
                                }
                                <div class="d-flex justify-content-between align-items-center mt-auto">
                                    <h6 class="card-subtitle mb-0" style="">@curso.Precio.ToString("C", System.Globalization.CultureInfo.CreateSpecificCulture("es-VE"))</h6>
                                    <a asp-action="Detalles" asp-route-id="@curso.Id" class="btn btn-primary text-white">Ver Detalles</a>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>

            <nav aria-label="Paginación de cursos" class="mt-5 pb-5">
                <ul class="pagination justify-content-center">
                    <li class="page-item @(Model.PaginaActual <= 1 ? "disabled" : "")">
                        <a href="#" class="page-link" data-page="@(Model.PaginaActual - 1)">Anterior</a>
                    </li>
                    @for (var i = 1; i <= Model.TotalPaginas; i++)
                    {
                        <li class="page-item @(i == Model.PaginaActual ? "active" : "")">
                            <a href="#" class="page-link" data-page="@i">@i</a>
                        </li>
                    }
                    <li class="page-item @(Model.PaginaActual >= Model.TotalPaginas ? "disabled" : "")">
                        <a href="#" class="page-link" data-page="@(Model.PaginaActual + 1)">Siguiente</a>
                    </li>
                </ul>
            </nav>
        }
    </div>
</div>