@model YSA.Web.Models.ViewModels.GestionarProductosViewModel

@{
    ViewData["Title"] = "Gestión de Productos";
}

<style>
    /* VARIABLES DE COLOR MONOCROMÁTICAS */
    :root {
        --color-primary: #000000; /* NEGRO PURO para botones primarios y títulos */
        --color-secondary: #333333; /* Gris oscuro para texto y acentos */
        --color-accent: #cccccc; /* Gris claro para bordes y separadores */
        --color-background: #ffffff; /* Fondo Blanco */
        --color-card-bg: #f8f8f8; /* Gris muy claro para el fondo de las tarjetas */
        --color-text-dark: #212529; /* Texto principal */
        --color-text-light: #ffffff; /* Texto Claro */
        /* Colores de estado ajustados para B/N */
        --color-success: #333333; /* Gris oscuro para éxito (Editar/Guardar) */
        --color-danger: #a00000; /* Rojo oscuro para Eliminar (Necesita ser distintivo) */
        --color-info: #666666; /* Gris medio para acciones de información/edición */
    }

    body {
        font-family: 'Poppins', sans-serif;
        background-color: var(--color-background);
        color: var(--color-text-dark);
        /* Reduje el padding general, es mejor usarlo en el container */
    }

    h1 {
        color: var(--color-primary);
        font-weight: 700;
        margin-bottom: 1.5rem;
    }

    /* ESTILO DE CARD DE GESTIÓN */
    .product-card {
        background-color: var(--color-card-bg); /* Fondo gris claro */
        border: 1px solid var(--color-accent); /* Borde gris sutil */
        border-radius: 0.5rem;
        padding: 1rem;
        margin-bottom: 1rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        transition: all 0.2s ease-in-out;
        height: 100%;
    }

        .product-card:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

    .product-title {
        color: var(--color-primary);
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
    }

    .product-detail span {
        font-weight: 500;
        color: var(--color-secondary);
    }

    .product-image {
        max-height: 150px;
        width: 100%;
        object-fit: cover;
        border-radius: 0.3rem;
        margin-bottom: 1rem;
        border: 1px solid #ddd;
    }

    .price-badge {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--color-primary);
        border: 2px solid var(--color-primary);
        padding: 0.25rem 0.75rem;
        border-radius: 0.5rem;
        display: inline-block;
        margin-top: 0.5rem;
    }

    /* BOTONES MONOCROMÁTICOS */

    /* Botón Crear/Primario (Negro) */
    .btn-primary {
        background-color: var(--color-primary) !important;
        border-color: var(--color-primary) !important;
        color: var(--color-text-light) !important;
        font-weight: 600;
    }

        .btn-primary:hover {
            background-color: var(--color-secondary) !important;
            border-color: var(--color-secondary) !important;
        }

    /* Botón Editar/Info (Gris Medio) */
    .btn-info {
        background-color: var(--color-info) !important;
        border-color: var(--color-info) !important;
        color: var(--color-text-light) !important;
    }

        .btn-info:hover {
            background-color: var(--color-secondary) !important;
            border-color: var(--color-secondary) !important;
        }

    /* Botón Eliminar/Danger (Rojo) - Se mantiene el rojo oscuro por seguridad */
    .btn-danger {
        background-color: var(--color-danger) !important;
        border-color: var(--color-danger) !important;
        color: var(--color-text-light) !important;
    }

        .btn-danger:hover {
            background-color: #7b0000 !important;
            border-color: #7b0000 !important;
        }

    /* Estilo del Modal para mantener la coherencia */
    .modal-content {
        border-radius: 0.75rem;
        border: 1px solid var(--color-primary);
    }

    .modal-header {
        background-color: var(--color-card-bg);
        border-bottom: 1px solid var(--color-accent);
    }

</style>

<div class="container mt-5 pt-5 pb-5 mb-5">

    <h1>@ViewData["Title"]</h1>

    <p>
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#crearProductoModal">
            <i class="fas fa-plus-circle me-2"></i> Crear Nuevo Producto
        </button>
    </p>

    @if (Model.Productos != null && Model.Productos.Any())
    {
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3 pb-5 mb-5">
            @foreach (var item in Model.Productos)
            {
                <div class="col">
                    <div class="product-card d-flex flex-column justify-content-between">
                        <div>
                            @if (!string.IsNullOrEmpty(item.UrlImagen))
                            {
                                <img src="@Url.Content(item.UrlImagen)" class="product-image" alt="Portada de @item.Titulo">
                            }
                            else
                            {
                                <img src="https://via.placeholder.com/400x150.png?text=Sin+Imagen" class="product-image" alt="Sin imagen">
                            }

                            <div class="product-title">@item.Titulo</div>
                            <div class="product-detail text-muted mb-2">Tipo: <span>@Html.DisplayFor(modelItem => item.TipoProducto)</span></div>
                            <div class="product-detail text-muted mb-2">Autor: <span>@Html.DisplayFor(modelItem => item.AutorNombre)</span></div>
                            <div class="product-detail text-muted mb-3">Categorías: <span>@Html.DisplayFor(modelItem => item.Categorias)</span></div>
                        </div>

                        <div class="d-flex justify-content-between align-items-center mt-auto pt-2">
                            <span class="price-badge">@Html.DisplayFor(modelItem => item.Precio)</span>
                            <div class="btn-group">
                                <a asp-action="EditarProducto" asp-route-id="@item.Id" class="btn btn-sm btn-info me-1">
                                    <i class="fas fa-edit"></i> Editar
                                </a>
                                <form asp-action="EliminarProducto" asp-route-id="@item.Id" method="post" style="display:inline;" onsubmit="return confirm('¿Estás seguro de que deseas eliminar este producto?');">
                                    @Html.AntiForgeryToken()
                                    <button type="submit" class="btn btn-sm btn-danger">
                                        <i class="fas fa-trash-alt"></i> Eliminar
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="alert alert-info text-center mt-4" role="alert">
            No hay productos registrados para gestionar.
        </div>
    }
</div>

@* El Modal de Creación se mantiene igual, ya que es funcional *@
<div class="modal fade" id="crearProductoModal" tabindex="-1" aria-labelledby="crearProductoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="crearProductoModalLabel">Crear Nuevo Producto</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form asp-action="CrearProducto" method="post" enctype="multipart/form-data">
                <div class="modal-body">
                    <div class="form-group mb-3">
                        <label asp-for="NuevoProducto.Titulo" class="form-label">Título</label>
                        <input asp-for="NuevoProducto.Titulo" class="form-control" required />
                    </div>

                    <div class="form-group mb-3">
                        <label asp-for="NuevoProducto.DescripcionCorta" class="form-label">Descripción Corta</label>
                        <input asp-for="NuevoProducto.DescripcionCorta" class="form-control" />
                    </div>

                    <div class="form-group mb-3">
                        <label asp-for="NuevoProducto.DescripcionLarga" class="form-label">Descripción Larga</label>
                        <textarea asp-for="NuevoProducto.DescripcionLarga" class="form-control"></textarea>
                    </div>

                    <div class="form-group mb-3">
                        <label asp-for="NuevoProducto.TipoProducto" class="form-label">Tipo de Producto</label>
                        <select asp-for="NuevoProducto.TipoProducto" class="form-control" required>
                            <option value="">-- Seleccionar --</option>
                            <option value="pdf">PDF</option>
                            <option value="revista">Revista</option>
                        </select>
                    </div>

                    <div class="form-group mb-3">
                        <label asp-for="NuevoProducto.Precio" class="form-label">Precio</label>
                        <input asp-for="NuevoProducto.Precio" class="form-control" type="number" step="0.01" required />
                    </div>

                    <div class="form-group mb-3">
                        <label asp-for="NuevoProducto.ImagenPortada" class="form-label">Imagen de Portada</label>
                        <input asp-for="NuevoProducto.ImagenPortada" type="file" class="form-control" />
                    </div>

                    <div class="form-group mb-3">
                        <label asp-for="NuevoProducto.ArchivoDigital" class="form-label">Archivo Digital (PDF)</label>
                        <input asp-for="NuevoProducto.ArchivoDigital" type="file" class="form-control" required />
                    </div>

                    <div class="form-group mb-3">
                        <label asp-for="NuevoProducto.AutorId" class="form-label">Autor</label>
                        <select asp-for="NuevoProducto.AutorId" class="form-control" asp-items="@Model.AutoresDisponibles">
                            <option value="">-- Seleccionar --</option>
                        </select>
                    </div>

                    <div class="form-group mb-3">
                        <label asp-for="NuevoProducto.CategoriaIds" class="form-label">Categorías</label>
                        <select asp-for="NuevoProducto.CategoriaIds" class="form-control" multiple asp-items="@Model.CategoriasDisponibles">
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Crear Producto</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}