@model YSA.Web.Models.ViewModels.CrearProductoViewModel

@{
    ViewData["Title"] = "Editar Producto Digital";
    // Propiedades para simplificar el acceso a los datos existentes
    string currentImageUrl = TempData["UrlImagenExistente"]?.ToString();
    string currentFileUrl = TempData["UrlArchivoExistente"]?.ToString();

    // Si el ViewModel tiene la propiedad, es mejor usarla
    // string currentImageUrl = Model.UrlImagenExistente;
}

<style>
    .form-container {
        max-width: 900px; /* Ampliamos un poco el contenedor */
        margin: 0 auto;
        padding: 2rem;
        background-color: #ffffff;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    }

    .form-group label {
        font-weight: 600;
        margin-bottom: 0.5rem;
    }

    .form-control:focus {
        border-color: #000;
        box-shadow: 0 0 0 0.2rem rgba(0, 0, 0, 0.1);
    }

    .main-btn {
        background-color: black;
        border-color: black;
        transition: background-color 0.3s;
    }

        .main-btn:hover {
            background-color: #333;
            border-color: #333;
        }

    .current-image-preview {
        max-height: 150px;
        width: auto;
        border: 1px solid #ddd;
        border-radius: 8px;
        margin-top: 10px;
        object-fit: contain;
    }

    .card-section {
        border: 1px solid #f0f0f0;
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        background-color: #fcfcfc;
    }
</style>

<div class="container py-4">
    <h1 class="fw-bold mb-4 text-center">
        <i class="fas fa-box-open me-2 text-primary"></i> @ViewData["Title"]
    </h1>
    <hr class="mb-5" />

    <div class="form-container pb-5">
        <form asp-action="EditarProducto" enctype="multipart/form-data">
            <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

            <input type="hidden" asp-for="Id" />

            <div class="row">

                <div class="col-md-6">
                    <div class="card-section">
                        <h5 class="fw-bold mb-3">Detalles del Contenido</h5>

                        <div class="form-group mb-3">
                            <label asp-for="Titulo" class="form-label"></label>
                            <input asp-for="Titulo" class="form-control" placeholder="Ej: Pinceles Procreate Vol. 3" />
                            <span asp-validation-for="Titulo" class="text-danger"></span>
                        </div>

                        <div class="form-group mb-3">
                            <label asp-for="DescripcionCorta" class="form-label"></label>
                            <input asp-for="DescripcionCorta" class="form-control" maxlength="150" placeholder="Máx 150 caracteres para listados" />
                            <span asp-validation-for="DescripcionCorta" class="text-danger"></span>
                        </div>

                        <div class="form-group mb-3">
                            <label asp-for="DescripcionLarga" class="form-label"></label>
                            <textarea asp-for="DescripcionLarga" class="form-control" rows="5" placeholder="Descripción detallada para la página de producto."></textarea>
                            <span asp-validation-for="DescripcionLarga" class="text-danger"></span>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="card-section">
                        <h5 class="fw-bold mb-3">Venta y Distribución</h5>

                        <div class="form-group mb-3">
                            <label asp-for="TipoProducto" class="form-label"></label>
                            <select asp-for="TipoProducto" class="form-select" asp-items="@Model.TiposProductoDisponibles">
                                <option value="">-- Seleccione el tipo --</option>
                            </select>
                            <span asp-validation-for="TipoProducto" class="text-danger"></span>
                        </div>

                        <div class="form-group mb-3">
                            <label asp-for="Precio" class="form-label"></label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input asp-for="Precio" type="number" step="0.01" class="form-control" />
                            </div>
                            <span asp-validation-for="Precio" class="text-danger"></span>
                        </div>

                        <div class="form-group mb-3">
                            <label asp-for="ArchivoDigital" class="form-label">Subir Archivo Digital (Opcional)</label>
                            <input asp-for="ArchivoDigital" type="file" class="form-control" />
                            <span asp-validation-for="ArchivoDigital" class="text-danger"></span>
                            @if (!string.IsNullOrEmpty(currentFileUrl))
                            {
                                <div class="alert alert-secondary alert-sm mt-2 p-2">
                                    <i class="fas fa-file-alt me-1"></i> Archivo actual:
                                    <a href="@currentFileUrl" target="_blank" class="fw-semibold text-decoration-none">Ver enlace</a>
                                    <small class="d-block text-muted">Sube un nuevo archivo para reemplazarlo.</small>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>

            <div class="card-section mt-4">
                <h5 class="fw-bold mb-3">Clasificación y Medios</h5>
                <div class="row">

                    <div class="col-md-6">
                        <div class="form-group mb-4">
                            <label asp-for="AutorId" class="form-label"></label>
                            <select asp-for="AutorId" class="form-select" asp-items="@Model.AutoresDisponibles">
                                <option value="">-- Seleccionar Autor/Artista --</option>
                            </select>
                            <span asp-validation-for="AutorId" class="text-danger"></span>
                        </div>

                        <div class="form-group mb-4">
                            <label asp-for="CategoriaIds" class="form-label"></label>
                            <select asp-for="CategoriaIds" class="form-select" multiple asp-items="@Model.CategoriasDisponibles" style="height: 150px;">
                            </select>
                            <small class="form-text text-muted">Mantén Ctrl (o Cmd) para seleccionar múltiples categorías.</small>
                            <span asp-validation-for="CategoriaIds" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="form-group mb-4">
                            <label asp-for="ImagenPortada" class="form-label">Cambiar Imagen de Portada</label>
                            <input asp-for="ImagenPortada" type="file" class="form-control" accept="image/*" />
                            <span asp-validation-for="ImagenPortada" class="text-danger"></span>

                            @if (!string.IsNullOrEmpty(currentImageUrl))
                            {
                                <p class="text-muted small mt-2 mb-1">Imagen actual:</p>
                                <img src="@currentImageUrl" alt="Imagen del producto" class="img-fluid current-image-preview" />
                                <small class="form-text text-muted">Sube un nuevo archivo para reemplazarla.</small>
                            }
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group text-center mt-5">
                <button type="submit" class="btn main-btn text-white btn-lg shadow-sm me-3">
                    <i class="fas fa-sync-alt me-2"></i> Actualizar Producto
                </button>
                <a asp-action="GestionarProductos" class="btn btn-secondary btn-lg">
                    <i class="fas fa-arrow-left me-2"></i> Volver a la Lista
                </a>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}