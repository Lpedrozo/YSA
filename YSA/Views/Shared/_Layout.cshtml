@using Microsoft.AspNetCore.Identity
@using YSA.Core.Entities

@inject SignInManager<Usuario> SignInManager
@inject UserManager<Usuario> UserManager
<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>@ViewData["Title"] - YoSoyArte</title>

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

	<link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
	<link rel="stylesheet" href="~/YSA.styles.css" asp-append-version="true" />

	<style>
		/* --- ESTILOS RESPONSIVE DEL HEADER --- */

		.main-header {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			background-color: white;
			/* Padding más compacto para el header general */
			padding: 1rem 1rem;
			z-index: 1040;
			transition: all 0.3s ease-in-out;
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
		}

			.main-header.scroll-header-shrink {
				/* Padding aún más compacto para el header encogido */
				padding: 0.5rem 1rem;
				background-color: rgba(255, 255, 255, 0.9);
				backdrop-filter: blur(5px);
				box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
			}

		/* Botón de Hamburguesa */
		.navbar-toggler {
			border: none !important;
			background-color: transparent !important;
			padding: 0.5rem 0.75rem;
			z-index: 1050;
			position: relative;
		}

		.navbar-toggler-icon {
			background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba%280, 0, 0, 0.8%29' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e") !important;
		}

		/* Estilos del Logo (ahora para la imagen) */
		.header-logo {
			color: black;
			text-decoration: none;
			transition: all 0.3s ease-in-out;
			display: flex;
			align-items: center;
			justify-content: center;
			/* TAMAÑO DE ESCRITORIO (SE MANTIENE GRANDE) */
			height: 90px;
		}

			/* Estilo para la imagen del logo */
			.header-logo img {
				height: 100%;
				width: auto;
				max-width: 100%;
				transition: height 0.3s ease-in-out;
			}

		/* Ajuste del tamaño del logo cuando el header se encoge */
		.main-header.scroll-header-shrink .header-logo {
			/* TAMAÑO DE ESCRITORIO SHRINK (SE MANTIENE GRANDE) */
			height: 80px;
		}

			.main-header.scroll-header-shrink .header-logo img {
				height: 100%;
			}

		/* Centrar el logo en escritorio (d-lg-block) */
		.header-logo.navbar-brand-center {
			position: absolute;
			left: 50%;
			transform: translateX(-50%);
			z-index: 1050;
		}

		/* Ocultar wrapper y logo en móvil para que no choque con el menú */
		@@media (max-width: 991.98px) {
			/* AJUSTE CLAVE: Hacemos que el container use flexbox para alinear los extremos */
			.container-fluid {
				display: flex;
				justify-content: space-between;
				align-items: center;
			}
			/* Ocultamos el logo centrado de escritorio en móvil */
			.header-logo.navbar-brand-center {
				display: none !important;
			}
			/* Hacemos visible el logo de la derecha en móvil y definimos su tamaño */
			.header-logo.navbar-brand-mobile {
				/* Sobrescribimos el d-none inicial */
				display: flex !important;
				/* MODIFICADO: TAMAÑO INTERMEDIO */
				height: 70px;
			}
			/* Ajustamos el tamaño en shrink para el logo móvil */
			.main-header.scroll-header-shrink .header-logo.navbar-brand-mobile {
				/* MODIFICADO: TAMAÑO INTERMEDIO SHRINK */
				height: 60px;
			}
		}

		/* Estilos de los enlaces de navegación */
		.header-nav-link {
			color: black !important;
			transition: color 0.3s ease, background-color 0.3s ease;
		}

			.header-nav-link:hover {
				color: #3498db !important;
			}

		/* --- ESTILOS DE MENÚS DESPLEGABLES --- */

		.dropdown-menu-dark {
			background-color: white;
			border: 1px solid rgba(0, 0, 0, 0.1);
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
		}

			.dropdown-menu-dark .dropdown-item {
				color: black;
			}

				.dropdown-menu-dark .dropdown-item:hover,
				.dropdown-menu-dark .dropdown-item:focus {
					background-color: #f8f9fa;
					color: #3498db;
				}

		/* Ajustes específicos para el dropdown de Mi Aprendizaje */
		#miAprendizajeDropdown + div.dropdown-menu {
			min-width: 300px;
			padding: 0.5rem;
			background-color: #f8f9fa;
			border: 1px solid rgba(0, 0, 0, 0.1);
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
		}

		@@media (min-width: 992px) {
			#miAprendizajeDropdown + div.dropdown-menu {
				right: 0;
				left: auto;
			}
		}

		#miAprendizajeDropdown + div.dropdown-menu .dropdown-item {
			padding: 0.5rem 1rem;
			color: black;
			border-radius: 5px;
			margin-bottom: 5px;
		}

			#miAprendizajeDropdown + div.dropdown-menu .dropdown-item:hover {
				background-color: #3498db;
				color: white;
			}

		#miAprendizajeDropdown + div.dropdown-menu small {
			color: #6c757d !important;
		}

		/* --- CONTENIDO PRINCIPAL Y FOOTER --- */
		body {
			display: flex;
			flex-direction: column;
			min-height: 100vh;
			/* Ajuste del padding-top para el header más compacto en móvil */
			padding-top: 8rem;
		}

		.main-content {
			flex: 1;
		}

		.footer {
			background-color: black !important;
			color: white !important;
		}

		.social-icons-footer a {
			color: white;
			font-size: 1.5rem;
			margin: 0 0.75rem;
			transition: color 0.3s ease;
		}

			.social-icons-footer a:hover {
				color: #3498db;
			}

		/* WhatsApp Float Button */
		.whatsapp-float {
			position: fixed;
			width: 60px;
			height: 60px;
			bottom: 40px;
			right: 40px;
			background-color: #25d366;
			border-radius: 50px;
			text-align: center;
			font-size: 30px;
			box-shadow: 2px 2px 3px #999;
			z-index: 1050;
			display: flex;
			align-items: center;
			justify-content: center;
			transition: transform 0.3s ease-in-out;
			color: #FFF;
		}

			.whatsapp-float:hover {
				color: #FFF;
				transform: scale(1.1);
			}

		@@media (max-width: 768px) {
			.whatsapp-float {
				width: 50px;
				height: 50px;
				bottom: 20px;
				right: 20px;
				font-size: 25px;
			}
		}
		/* Estilos para el dropdown de notificaciones */
		#notificacionesDropdown + .dropdown-menu {
			min-width: 350px;
			max-height: 500px;
			overflow-y: auto;
		}

		.notification-item {
			transition: background-color 0.2s ease;
		}

			.notification-item:hover {
				background-color: #f8f9fa;
			}

		.notification-unread {
			background-color: #f0f8ff;
			border-left: 3px solid #007bff;
		}

		.notification-badge {
			position: absolute;
			top: 0;
			right: 0;
			transform: translate(25%, -25%);
		}
	</style>
</head>

<body>

	<header class="main-header navbar navbar-expand-lg navbar-light">
		<div class="container-fluid">

			@* Botón de Menú (Izquierda) *@
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>

			@* Logo para escritorio (Centrado, oculto en móvil) *@
			<a class="header-logo navbar-brand navbar-brand-center d-none d-lg-block" asp-controller="Home" asp-action="Index">
				<img src="~/diseño/logoYSA.png" alt="Logo YoSoyArte" />
			</a>

			@* Logo para móvil (Derecha, visible solo en móvil) *@
			<a class="header-logo navbar-brand navbar-brand-mobile d-none" asp-controller="Home" asp-action="Index">
				<img src="~/diseño/logoYSA.png" alt="Logo YoSoyArte" />
			</a>

			<div class="collapse navbar-collapse" id="navbarSupportedContent">

				<ul class="navbar-nav me-auto mb-2 mb-lg-0">
					<li class="nav-item">
						<a class="nav-link text-dark header-nav-link" asp-controller="Home" asp-action="Index"><i class="fas fa-home me-2"></i>Inicio</a>
					</li>
					<li class="nav-item">
						<a class="nav-link text-dark header-nav-link" asp-controller="Curso" asp-action="Index"><i class="fas fa-book-open me-2"></i>Cursos</a>
					</li>
					<li class="nav-item">
						<a class="nav-link text-dark header-nav-link" asp-controller="Revista" asp-action="Index"><i class="fas fa-newspaper me-2"></i>Revista</a>
					</li>
					<li class="nav-item">
						<a class="nav-link text-dark header-nav-link" asp-controller="Producto" asp-action="Index"><i class="fas fa-file-pdf me-2"></i>Productos</a>
					</li>
				</ul>

				<ul class="navbar-nav ms-auto mb-2 mb-lg-0">

					@if (SignInManager.IsSignedIn(User))
					{
						@* Rol: Estudiante - Mi Aprendizaje (Dropdown) *@
						@if (User.IsInRole("Estudiante"))
						{
							<li class="nav-item dropdown">
								<a class="nav-link text-dark header-nav-link" href="#" id="miAprendizajeDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
									<i class="fas fa-graduation-cap me-2"></i>Mi aprendizaje
								</a>
								@await Component.InvokeAsync("CursosUsuario")
							</li>
						}
						<li class="nav-item dropdown">
							<a class="nav-link text-dark header-nav-link position-relative" href="#" id="notificacionesDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
								<i class="fas fa-bell me-2"></i>Notificaciones
								@await Component.InvokeAsync("NotificacionesMenu")
							</a>
						</li>
						@* Rol: Administrador - Panel (Link directo) *@
						@if (User.IsInRole("Administrador") || User.IsInRole("Asistente"))
						{
							<li class="nav-item">
								<a class="nav-link text-dark header-nav-link" asp-controller="Admin" asp-action="Panel" role="button">
									<i class="fas fa-chart-bar me-2"></i>Panel de admin
								</a>
							</li>
						}

						@* Rol: Artista - Mi Portafolio (Link directo) *@
						@if (User.IsInRole("Artista"))
						{
							<li class="nav-item">
								<a class="nav-link text-dark header-nav-link" asp-controller="Artista" asp-action="GestionarPortafolio" role="button">
									<i class="fas fa-file-alt me-2"></i>Mi portafolio
								</a>
							</li>
						}

						@* Menú Desplegable de Mi Cuenta *@
						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle text-dark header-nav-link" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
								<i class="fas fa-user-circle me-2"></i>Mi cuenta
							</a>
							<ul class="dropdown-menu dropdown-menu-dark dropdown-menu-lg-end" aria-labelledby="navbarDropdown">
								<li><a class="dropdown-item" asp-controller="Cuenta" asp-action="MiPerfil">Mi perfil</a></li>

								@* Ítems de Artista movidos aquí para no saturar la navegación principal en móvil *@
								@if (User.IsInRole("Artista"))
								{
									<li><a class="dropdown-item" asp-controller="Artista" asp-action="PreguntasPendientes">Preguntas</a></li>
									<li><a class="dropdown-item" asp-controller="Artista" asp-action="EntregasPendientes">Actividades</a></li>
								}

								<li><hr class="dropdown-divider"></li>
								<li><a class="dropdown-item" href="#" onclick="document.getElementById('logoutForm').submit();">Cerrar sesión</a></li>
							</ul>
						</li>
						<form asp-controller="Cuenta" asp-action="Logout" method="post" id="logoutForm" style="display: none;"></form>
					}
					else
					{
						@* Enlaces de Login y Registro *@
						<li class="nav-item">
							<a class="nav-link text-dark header-nav-link" asp-controller="Cuenta" asp-action="Login"><i class="fas fa-sign-in-alt me-2"></i>Iniciar sesión</a>
						</li>
						<li class="nav-item">
							<a class="nav-link text-dark header-nav-link" asp-controller="Cuenta" asp-action="Registro"><i class="fas fa-user-plus me-2"></i>Registrarse</a>
						</li>
					}
				</ul>
			</div>
		</div>
	</header>

	<div class="main-content mb-3 pb-3">
		@RenderBody()
	</div>

	<footer class="border-top footer text-muted bg-black">
		<div class="container">
			<div class="row">
				<div class="col-md-6 text-center text-md-start mb-md-0 mb-sm-0 mb-xs-0">
					<p style="color:white; font-size: 0.9rem;">&copy; @DateTime.Now.Year - YoSoyArte.Web. Todos los derechos reservados.</p>
					<a asp-controller="Home" asp-action="Privacidad" class="text-secondary text-decoration-none">Política de Privacidad</a>
					<a href="#" class="text-secondary text-decoration-none">Términos de Servicio</a>
				</div>
				<div class="col-md-6 text-center text-md-end">
					<div class="social-icons-footer">
						<a href="URL_TU_INSTAGRAM" target="_blank" title="Instagram"><i class="fab fa-instagram"></i></a>
						<a href="URL_TU_FACEBOOK" target="_blank" title="Facebook"><i class="fab fa-facebook-f"></i></a>
						<a href="URL_TU_TWITTER" target="_blank" title="Twitter/X"><i class="fab fa-twitter"></i></a>
						<a href="URL_TU_YOUTUBE" target="_blank" title="YouTube"><i class="fab fa-youtube"></i></a>
						<a href="URL_TU_PINTEREST" target="_blank" title="Pinterest"><i class="fab fa-pinterest"></i></a>
					</div>
				</div>
			</div>
		</div>
	</footer>

	@* Botón Flotante de WhatsApp *@
	@{
		var mensaje = "Hola, me gustaría recibir asistencia sobre:.";
		var mensajeCodificado = System.Web.HttpUtility.UrlEncode(mensaje);
		var telefono = "584121463374";
		var urlWhatsapp = $"https://wa.me/{telefono}?text={mensajeCodificado}";
	}
	<a href="@urlWhatsapp" class="whatsapp-float" target="_blank" title="Asistencia por WhatsApp">
		<i class="fab fa-whatsapp" style="color:#fff"></i>
	</a>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

	@* <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawR/h/nBSwYJ/5Q2bYgS2/C8hKxQ9E7eN9o=" crossorigin="anonymous"></script> *@
	<script src="~/js/site.js" asp-append-version="true"></script>
	<script>
		// Lógica para el header dinámico al hacer scroll
		document.addEventListener('DOMContentLoaded', () => {
			const mainHeader = document.querySelector('.main-header');
			window.addEventListener('scroll', () => {
				if (window.scrollY > 50) {
					mainHeader.classList.add('scroll-header-shrink');
				} else {
					mainHeader.classList.remove('scroll-header-shrink');
				}
			});
		});
	</script>
	@await RenderSectionAsync("Scripts", required: false)
</body>
</html>